<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="instascan.min.js"></script>
</head>
<body>
	<video id="video"></video>

	<script type="text/javascript">
		// const video = document.querySelector('#video');

		// navigator.mediaDevices.getUserMedia(constraints)
		// .then(stream => {
		// 	video.srcObject = stream;
		// 	video.play();
		// }).catch(err => {
		// 	console.log(err)
		// });

		let scanner = new Instascan.Scanner({ video: document.querySelector('#video'), mirror: false });
      	scanner.addListener('scan', content => {
      		handleQRContent(content);
        	console.log(content);
      	});

      	Instascan.Camera.getCameras().then(cameras => {
      		console.log(cameras);
      		let camera;

		    if (cameras.length > 0) {
		    	for (var i = 0; i < cameras.length; i++) {
		    		if(cameras[i].name.indexOf('back') >= 0){
		    			camera = cameras[i];
		    			break;
		    		}
		    	}
		    	if(camera != undefined){
		    		console.log('camera found');
		    		console.log(camera);
		      		scanner.start(camera);
		      	}
		      	else
		      		camera = cameras[0];
		    } else {
		      console.error('No cameras found.');
		    }
        }).catch(function (e) {
		    console.error(e);
	    });

	    function handleQRContent(content) {
	    	console.log(content);
	    	if(content == 1) {
	    		flash('success');
	    	}
	    	else if(content == 0) {
	    		flash('fail');
	    	}
	    }

	    function flash(type) {
	    	let color;

	    	if(type == 'success')
	    		color = '#07da63';
	    	else if (type == 'fail')
	    		color = '#cc0000';

	    	document.body.style.backgroundColor = color;
	    }
	</script>
</body>
</html>
